# 회식이

홈페이지 : [https://honest-hong.github.io/StaffDinner/](https://honest-hong.github.io/StaffDinner/)

## 프로젝트 내용

회식자리가 필요한 고객과 손님이 필요한 식당 사장님을 매칭시켜주는 앱입니다. 고객용 버전과 식당용 버전 2가지 버전의 앱을 개발하였습니다. 고객이 회식의 내용을 입력한 후에 신청서를 전송하면 근처 식당 사장님들에게 알림이 도착합니다. Android에서는 Retrofit2를 사용하여 서버로 전송하게 되며 Node.js의 Express로 개발한 서버는 이 내용을 MongoDB에 저장합니다. 그리고 FCM을 사용하여 알림을 전송합니다. 신청서를 받은 식당 사장님들은 내용을 확인한 후에 견적서를 작성하여 전송합니다. 견적서에는 식당 사장님들이 제공할 수 있는 서비스와 같은 내용을 포함하고 있습니다. 고객은 여러 식당으로부터 견적서를 받을 수 있으며 이 중에서 하나만을 선택하여 계약을 진행하게 됩니다. 그러면 계약에 실패한 다른 견적서는 모두 취소 알림을 받게 됩니다.

## 개발한 기능

- 로그인 및 회원가입 (카카오, 페이스북, 이메일)
- 실시간 신청서/견적서/계약서 알림 (FCM)
- 네트워크가 끊겼을 경우 내부 저장소 사용 (SQLite, Glide)
- Restful API (Express, Retrofit2)
- 신청서의 시간이 만료되었을 때 알림 (Crontab)
- 서버로부터 데이터 조금씩 가져오기 - 페이징
- 식당의 사진 저장하기 (Multer)

## 기술

- FCM : 모든 실시간 알림 기능
- SQLite : 안드로이드 앱의 내부 저장소
- Glide : 이미지 캐싱
- Crontab : 만료된 신청서 자동으로 제거
- Multer : 이미지 업로드

## 고민한 부분

### 모듈화

앱 버전이 2가지이기 때문에 공통적으로 사용하는 코드가 많았습니다. 처음에는 프로젝트를 2개로 만들려고 했지만 모듈화하는 방법을 알게 되었습니다. 하나의 프로젝트에 2개의 앱 모듈을 만들고 1개의 공용 라이브러리 모듈을 추가하였습니다.

### 갤러리 경로 호환성

이미지를 갤러리로부터 가져오는 방식을 Intent로 하였습니다. Intent로 가져올 때 onActivityResult가 호출되면서 경로를 가져오는데 이 때 경로가 기기 또는 버전마다 달랐습니다. Image Picker 라이브러리를 사용하기 보다는 호환성을 가진 코드를 작성하였습니다.

### 처음 사용하는 MongoDB

MongoDB를 처음 사용해서 어려웠습니다. 특히 거리를 계산하는 쿼리를 사용하기 위해서는 특별한 인덱스 특성을 부여해야하는데 이를 몰랐었기 때문에 한참을 해맸습니다. 결국 데이터베이스를 갈아 엎으면서 공식 문서를 다시 읽어본 후에 해결하였습니다.

### Crontab의 잘못된 사용

서버에서 신청서를 자동적으로 만료시켜주기 위해서는 Crontab이 필요했습니다. 기능을 수행하는 Crontab을 작성한 후에 실행하였지만 1시간 후 MongoDB가 터졌습니다. Crontab에서 MongoDB와의 Connection을 해지하지 않아서 발생한 오류였습니다. 로그를 확인하여 해결하였습니다.